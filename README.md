# Data-Centric Mask Detection: 마스크 착용 여부 탐지 AI 모델

## 프로젝트 개요

본 프로젝트는 마스크 착용 여부를 탐지하는 인공지능 모델을 개발하는 과정을 담고 있습니다. 특히, 기존의 모델 중심(model-centric) 접근 방식에서 벗어나 **데이터 중심(data-centric) 접근 방식**을 채택하여 AI 모델의 성능을 향상시키는 데 중점을 두었습니다.

데이터가 부족한 문제를 해결하기 위해 **스테이블 디퓨전(Stable Diffusion)**을 활용하여 다양한 조건의 인물 이미지를 생성했습니다. 또한, 생성된 이미지에 대한 라벨링 작업을 자동화하기 위해 **레티나페이스(RetinaFace)** 모델을 사용하여 시간과 비용을 절감했습니다. 최종적으로, 생성 및 라벨링된 데이터를 **YOLO(You Only Look Once)** 모델 학습에 사용하여 실시간으로 마스크 착용 여부를 탐지하는 모델을 구현했습니다.

## 주요 특징

*   **데이터 중심 AI 접근**: 모델 구조 변경을 최소화하고, 데이터의 질과 양을 개선하여 성능 향상을 도모합니다.
*   **합성 데이터 생성**: 스테이블 디퓨전을 활용하여 다양한 인종, 성별, 포즈, 배경의 마스크 착용 및 미착용 이미지 데이터를 대량으로 생성합니다.
*   **자동화된 라벨링**: 레티나페이스 얼굴 탐지 모델을 사용하여 생성된 이미지의 얼굴 영역을 자동으로 감지하고, 바운딩 박스(bounding box) 정보를 포함하는 라벨 파일을 생성합니다.
*   **실시간 객체 탐지**: YOLOv8 모델을 학습하여 웹캠을 통해 실시간으로 마스크 착용 여부를 높은 정확도로 탐지합니다.

## 프로젝트 파이프라인

본 프로젝트는 다음과 같은 4단계의 파이프라인으로 구성되어 있습니다.

1.  **데이터 생성 (Data Generation)**
    *   스테이블 디퓨전 모델(`Lykon/dreamshaper-8`)을 사용하여 'mask_on'과 'no_mask' 두 클래스에 대한 이미지를 각각 500개씩, 총 1000개의 이미지를 생성합니다.
    *   다양한 인종, 성별, 표정, 배경, 의상 등을 조합한 프롬프트를 사용하여 데이터의 다양성을 확보합니다.

2.  **데이터 라벨링 (Data Labeling)**
    *   사전 학습된 레티나페이스 모델(`Resnet50_Final.pth`)을 사용하여 생성된 이미지에서 얼굴 영역을 탐지합니다.
    *   탐지된 얼굴 영역의 좌표를 YOLO 모델 학습에 필요한 형식(`.txt`)으로 변환하여 라벨링을 자동화합니다.

3.  **모델 학습 (Model Training)**
    *   생성된 이미지와 라벨 데이터를 훈련(train) 및 검증(validation) 세트로 분할합니다.
    *   YOLOv8m 모델을 기반으로 마스크 착용 여부를 탐지하는 모델을 학습합니다.

4.  **모델 구현 (Model Deployment)**
    *   학습된 YOLO 모델 가중치(`best.pt`)를 로드하여 웹캠 영상에서 실시간으로 마스크 착용 여부를 탐지하는 애플리케이션을 구현합니다.

## 사용 기술

*   **AI/ML Frameworks**: PyTorch, Ultralytics YOLO, Diffusers, Transformers
*   **Models**: Stable Diffusion, RetinaFace, YOLOv8
*   **Tools**: OpenCV, NumPy, Matplotlib

## 실행 방법

### 1. 데이터 생성

`Diffusion_MaskOn&No_500+500.ipynb` 파일을 실행하여 마스크 착용 및 미착용 이미지를 생성합니다.

*   **사전 준비**: Hugging Face 토큰이 필요합니다.
*   **실행**: 노트북의 모든 셀을 순차적으로 실행하면 `mask_images` 디렉토리 내에 `mask_on`과 `no_mask` 폴더가 생성되고, 각 폴더에 500개의 이미지가 저장됩니다.

### 2. 라벨링 자동화

`RetinaFace_PrepareDataSet(label).ipynb` 파일을 실행하여 생성된 이미지에 대한 라벨 파일을 생성합니다.

*   **사전 준비**: 사전 학습된 RetinaFace 모델 가중치 파일(`Resnet50_Final.pth`)이 필요합니다.
*   **실행**: 노트북의 파일 경로를 자신의 환경에 맞게 수정한 후 실행하면 `labels` 디렉토리에 `.txt` 형식의 라벨 파일이 생성됩니다.

### 3. YOLO 모델 학습

`RetinaFace_Yolo_Train_img.ipynb` 파일을 실행하여 마스크 탐지 모델을 학습합니다.

*   **실행**: 노트북을 실행하면 데이터셋 분할, `data.yaml` 파일 생성이 자동으로 진행된 후 YOLO 모델 학습이 시작됩니다.
*   **결과**: 학습이 완료되면 `results` 디렉토리에 학습된 모델 가중치(`best.pt`)와 결과가 저장됩니다.

### 4. 실시간 마스크 탐지

`RetinaFace_Yolo_Mask_Detection.ipynb` 파일을 실행하여 웹캠으로 실시간 마스크 착용 여부를 탐지합니다.

*   **사전 준비**: 학습된 YOLO 모델 가중치 파일(`best.pt`)이 필요합니다.
*   **실행**: `model_path`를 학습된 모델 가중치 파일 경로로 설정한 후 노트북을 실행하면 웹캠이 활성화되고 실시간 탐지가 시작됩니다. 'q' 키를 누르면 종료됩니다.